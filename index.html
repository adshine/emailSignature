<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Signature Generator</title>

    <!-- Cropper.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">

    <!-- Cropper.js JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <!-- html2canvas for PNG generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #f5b062 0%, #008080 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            min-height: 600px;
        }
        
        .form-section {
            padding: 40px;
            background: #f8f9fa;
        }
        
        .preview-section {
            padding: 40px;
            background: white;
            border-left: 1px solid #e9ecef;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #008080;
            box-shadow: 0 0 0 3px rgba(0,128,128,0.1);
        }
        
        .preview-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }
        
        .signature-preview {
            border: 2px dashed #e9ecef;
            border-radius: 10px;
            padding: 20px;
            background: #fff;
            margin-bottom: 20px;
            min-height: 300px;
            overflow: auto;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
        }
        
        .btn-primary {
            background: #008080;
            color: white;
        }
        
        .btn-primary:hover {
            background: #006666;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #f5b062;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #e09a4a;
            transform: translateY(-2px);
        }
        
        .success-message {
            display: none;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 10px 15px;
            border-radius: 5px;
            margin-top: 15px;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .preview-section {
                border-left: none;
                border-top: 1px solid #e9ecef;
            }
            
            .button-group {
                flex-direction: column;
            }
        }
        
        .signature-output {
            font-family: Arial, sans-serif;
        }
        
        .instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-size: 14px;
        }
        
        .instructions h4 {
            margin-bottom: 10px;
            color: #856404;
        }
        
        .instructions ol {
            margin-left: 20px;
        }
        
    .instructions li {
        margin-bottom: 5px;
    }

    .file-download {
        background: #e7f5e7;
        border: 1px solid #a7e1a7;
        border-radius: 8px;
        padding: 15px;
        margin: 10px 0;
        font-size: 14px;
        color: #0f5132;
    }

    .file-download strong {
        color: #0f5132;
    }

    /* Cropping Modal Styles */
    .crop-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 9999;
    }

    .crop-modal.show {
        display: block;
    }

    .crop-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        border-radius: 10px;
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .crop-image {
        max-width: 100%;
        height: auto;
        max-height: 400px;
    }

    .crop-controls {
        margin-top: 15px;
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .crop-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
    }

    .crop-btn-primary {
        background: #008080;
        color: white;
    }

    .crop-btn-secondary {
        background: #f5b062;
        color: white;
    }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Email Signature Generator</h1>
            <p>Create professional email signatures for Zoho Mail and other email clients</p>
        </div>
        
        <div class="content">
            <div class="form-section">
                <h2>Signature Details</h2>
                
                <div class="form-group">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" placeholder="John Doe" value="">
                </div>
                
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" placeholder="john.doe@company.com" value="">
                </div>
                
                <div class="form-group">
                    <label for="role">Job Title/Role</label>
                    <input type="text" id="role" placeholder="Senior Developer" value="">
                </div>
                
                <div class="form-group">
                    <label for="profileImageUpload">Profile Image Upload</label>
                    <input type="file" id="profileImageUpload" accept="image/*" onchange="handleImageUpload(event)">
                    <small style="color: #666; margin-top: 5px; display: block;">OR enter a URL below:</small>
                </div>

                <div class="form-group">
                    <label for="profileImage">Profile Image URL</label>
                    <input type="url" id="profileImage" placeholder="https://i.imgur.com/K5bOJ3c.png" value="https://i.imgur.com/K5bOJ3c.png">
                </div>
                <div class="form-group">
                    <label for="logoImage">Logo Image URL</label>
                    <input type="url" id="logoImage" placeholder="https://your-cdn.com/landnest-logo.png" value="">
                </div>
                
                <div class="instructions">
                    <h4>How to use in Zoho Mail:</h4>
                    <ol>
                        <li>Fill in your details above</li>
                        <li>Click "Copy Signature HTML"</li>
                        <li>Go to Zoho Mail Settings â†’ Signatures</li>
                        <li>Click "Insert HTML" and paste the copied content</li>
                        <li>Save your signature</li>
                    </ol>
                </div>

                <div class="file-download">
                    <strong>Note:</strong> Some email clients (like Gmail) may not display data URL images. If your signature doesn't show properly, save the cropped image as a PNG file using the "Save PNG" button in the crop modal and host it on a public site (like Imgur), then paste the URL into the Profile Image URL field.
                </div>
            </div>
            
            <div class="preview-section">
                <h2 class="preview-title">Live Preview</h2>
                
                <div class="signature-preview" id="preview">
                    <!-- Preview will be generated here -->
                </div>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="copySignature()">Copy Signature HTML</button>
                    <button class="btn btn-secondary" onclick="downloadSignature()">Download HTML File</button>
                    <button class="btn btn-secondary" onclick="downloadSignaturePNG()">Download PNG</button>
                </div>
                
                <div class="success-message" id="successMessage">
                    Signature copied successfully!
                </div>

                <!-- Add "Crop Image" button when an uploaded image exists -->
                <div class="button-group" id="cropButtonContainer" style="display: none; margin-top: 10px;">
                    <button class="btn btn-secondary" onclick="showCropModal()">Crop Image</button>
                </div>
            </div>
        </div>

        <!-- Image Cropping Modal -->
        <div class="crop-modal" id="cropModal">
            <div class="crop-content">
                <h3>Crop Your Profile Image</h3>
                <img id="cropImage" class="crop-image" src="" alt="Image to crop">
                <div class="crop-controls">
                    <button class="crop-btn crop-btn-secondary" onclick="saveCroppedImage()">Save PNG</button>
                    <button class="crop-btn crop-btn-secondary" onclick="cancelCrop()">Cancel</button>
                    <button class="crop-btn crop-btn-primary" onclick="commitCrop()">Apply to Signature</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Handle image upload
        async function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file.');
                event.target.value = '';
                return;
            }

            // Validate file size (max 5MB)
            const maxSize = 5 * 1024 * 1024; // 5MB in bytes
            if (file.size > maxSize) {
                alert('File size must be less than 5MB.');
                event.target.value = '';
                return;
            }

            try {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Store the data URL and update the URL field
                    document.getElementById('profileImage').value = e.target.result;
                    // Show crop button
                    document.getElementById('cropButtonContainer').style.display = 'flex';
                    // Store original image data for cropping
                    window.originalImageData = e.target.result;
                    // Update preview
                    updatePreview();
                };
                reader.readAsDataURL(file);
            } catch (error) {
                console.error('Error reading file:', error);
                alert('Error reading the selected file.');
            }
        }

        // Generate signature HTML
        function generateSignature() {
            const name = document.getElementById('name').value || '{{ Name }}';
            const email = document.getElementById('email').value || '{{ Email Address }}';
            const role = document.getElementById('role').value || '{{ Job Title }}';
            const profileImage = document.getElementById('profileImage').value || 'https://i.imgur.com/K5bOJ3c.png';

            return `<div style="width: 100%; max-width: 600px; font-family: Arial, sans-serif; position: relative;">
    <img src="${profileImage}" alt="Profile Picture" width="110" style="width: 110px; height: 110px; border-radius: 50%; border: 6px solid #ffffff; position: absolute; top: 40px; left: 30px; z-index: 2;">
    
    <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tbody>
            <tr>
                <td>
                    <div style="min-height: 100px; background-color: #f5b062; width: 100%;"></div>
                </td>
            </tr>
            <tr>
                <td style="background-color: #ffffff; padding: 0 30px 20px 30px;">
                    <table width="100%" cellpadding="0" cellspacing="0" border="0">
                        <tbody>
                            <tr>
                                <td valign="top">
                                    <div style="height: 70px;"></div>
                                    <p style="margin: 0; font-size: 18px; font-weight: bold; color: #000000; font-family: Arial, sans-serif;">${name}</p>
                                    <p style="margin: 10px 0; font-size: 14px; color: #008080; font-family: Arial, sans-serif;">${email}</p>
                                    <p style="margin: 0; background-color: #008080; color: #ffffff; padding: 10px; display: inline-block; font-size: 14px; font-weight: bold; font-family: Arial, sans-serif;">${role}</p>
                                </td>
                                <td width="200" valign="middle">
                                    <table width="100%" cellpadding="0" cellspacing="0" border="0">
                                        <tr>
                                            <td width="20">&nbsp;</td>
                                            <td width="1" style="border-left: 1px solid #008080;">&nbsp;</td>
                                            <td width="20">&nbsp;</td>
                                            <td width="150" align="center">
                                                <svg id="Layer_2" data-name="Layer 2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 104.7 65.57">
                                                    <defs>
                                                        <style>
                                                            .cls-1 { fill: #fbb265; }
                                                            .cls-2 { fill: #12675c; }
                                                        </style>
                                                    </defs>
                                                    <g id="Layer_1-2" data-name="Layer 1">
                                                        <polygon class="cls-2" points="14.3 61.4 14.3 65.54 13.65 65.54 13.65 63.72 11.56 63.72 11.56 65.54 10.91 65.54 10.91 61.4 11.56 61.4 11.56 63.13 13.65 63.13 13.65 61.4 14.3 61.4"/>
                                                        <path class="cls-2" d="M18.12,65.57c-.3,0-.57-.06-.81-.18-.24-.12-.45-.27-.62-.47-.17-.2-.31-.43-.4-.68-.1-.25-.14-.51-.14-.77s.05-.54,.15-.79c.1-.25,.24-.47,.42-.67,.18-.2,.39-.35,.63-.47,.24-.11,.51-.17,.79-.17s.56,.06,.81,.18c.24,.12,.45,.28,.62,.48,.17,.2,.31,.43,.4,.68,.1,.25,.14,.5,.14,.76,0,.27-.05,.54-.15,.79-.1,.25-.24,.47-.42,.67-.18,.2-.39,.35-.63,.46-.24,.11-.51,.17-.79,.17m-1.32-2.1c0,.19,.03,.38,.09,.57,.06,.18,.15,.35,.26,.49,.12,.14,.25,.25,.42,.34,.16,.08,.35,.12,.55,.12s.4-.04,.56-.13c.16-.09,.3-.2,.41-.35,.11-.15,.19-.31,.25-.49,.06-.18,.09-.36,.09-.55,0-.19-.03-.38-.09-.56-.06-.18-.15-.34-.26-.48-.12-.14-.26-.25-.42-.34-.16-.08-.34-.12-.54-.12-.21,0-.4,.04-.56,.13-.16,.09-.3,.2-.41,.34-.11,.14-.2,.31-.26,.48-.06,.18-.09,.36-.09,.55"/>
                                                        <polygon class="cls-2" points="25.43 65.54 25.43 62.59 24.21 64.83 23.83 64.83 22.6 62.59 22.6 65.54 21.95 65.54 21.95 61.4 22.65 61.4 24.02 63.93 25.39 61.4 26.09 61.4 26.09 65.54 25.43 65.54"/>
                                                        <polygon class="cls-2" points="31.02 64.96 31.02 65.54 28.18 65.54 28.18 61.4 30.97 61.4 30.97 61.98 28.84 61.98 28.84 63.16 30.68 63.16 30.68 63.7 28.84 63.7 28.84 64.96 31.02 64.96"/>
                                                        <path class="cls-2" d="M35.31,62.38s-.1-.09-.17-.14c-.07-.05-.16-.09-.26-.14-.1-.04-.21-.08-.33-.11-.12-.03-.24-.04-.36-.04-.27,0-.47,.05-.61,.15-.13,.1-.2,.24-.2,.42,0,.13,.04,.24,.11,.31,.07,.08,.19,.14,.34,.19,.15,.05,.34,.11,.57,.16,.28,.07,.52,.14,.73,.24,.21,.09,.36,.21,.47,.36,.11,.15,.16,.35,.16,.6,0,.21-.04,.39-.12,.54s-.19,.27-.33,.37c-.14,.09-.3,.16-.48,.21-.18,.04-.38,.07-.59,.07s-.41-.02-.62-.06c-.2-.04-.4-.11-.58-.19-.18-.08-.35-.18-.51-.31l.3-.56c.05,.05,.12,.11,.22,.17,.1,.06,.21,.12,.33,.17,.13,.05,.26,.1,.41,.14,.15,.04,.3,.06,.46,.06,.26,0,.46-.05,.6-.14,.14-.09,.21-.22,.21-.39,0-.14-.04-.25-.13-.33-.09-.08-.22-.15-.39-.21-.17-.06-.38-.12-.61-.17-.27-.07-.5-.15-.68-.24-.18-.09-.32-.2-.41-.34-.09-.14-.14-.31-.14-.53,0-.27,.07-.5,.2-.69,.13-.19,.31-.33,.54-.42,.23-.1,.48-.14,.77-.14,.19,0,.36,.02,.53,.06,.17,.04,.32,.1,.47,.17,.15,.07,.28,.15,.4,.24l-.3,.54Z"/>
                                                        <path class="cls-2" d="M42.92,65.54l-1.99-2.11c-.17-.18-.3-.33-.4-.45-.1-.12-.17-.24-.21-.34-.04-.1-.06-.21-.06-.32,0-.19,.05-.35,.14-.49,.1-.14,.23-.25,.39-.33,.17-.08,.35-.12,.56-.12,.19,0,.37,.03,.53,.1,.16,.07,.29,.17,.38,.29,.1,.13,.15,.29,.15,.48,0,.18-.05,.34-.14,.48-.09,.14-.22,.27-.37,.39-.15,.12-.33,.24-.52,.35-.15,.1-.28,.19-.4,.28-.12,.09-.22,.19-.28,.3-.07,.11-.1,.22-.1,.35s.04,.25,.11,.35c.07,.1,.17,.18,.3,.24,.12,.06,.26,.08,.41,.08,.18,0,.35-.04,.52-.13,.16-.09,.31-.21,.44-.36,.13-.16,.23-.34,.3-.56,.07-.21,.11-.45,.11-.7h.53c0,.34-.05,.65-.16,.93-.11,.28-.25,.51-.43,.71-.18,.2-.39,.35-.62,.46-.24,.11-.48,.16-.74,.16s-.51-.05-.71-.16c-.21-.11-.37-.25-.48-.42-.11-.18-.17-.37-.17-.59s.05-.4,.15-.56c.1-.16,.23-.3,.38-.43,.16-.12,.32-.24,.47-.34,.17-.11,.32-.2,.44-.28,.13-.08,.22-.17,.29-.25,.07-.09,.11-.18,.11-.28,0-.12-.04-.22-.13-.29-.09-.07-.2-.11-.34-.11-.1,0-.19,.02-.26,.06-.08,.04-.13,.1-.18,.17-.04,.07-.06,.15-.06,.23,0,.06,.02,.12,.05,.17,.03,.06,.09,.14,.18,.23,.08,.09,.2,.22,.35,.38l2.34,2.45h-.84Z"/>
                                                        <path class="cls-2" d="M48.02,65.54v-4.14h1.74c.19,0,.36,.04,.51,.12,.16,.08,.29,.18,.41,.31,.12,.13,.21,.27,.27,.43,.06,.16,.09,.32,.09,.49,0,.23-.05,.45-.15,.65-.1,.21-.25,.38-.44,.51-.19,.13-.41,.19-.66,.19h-1.12v1.44h-.65Zm.65-2.02h1.08c.12,0,.23-.03,.33-.1,.09-.07,.17-.16,.22-.28,.05-.12,.08-.25,.08-.4s-.03-.29-.09-.4c-.06-.12-.14-.21-.24-.27-.1-.06-.21-.1-.32-.1h-1.04v1.54Z"/>
                                                        <path class="cls-2" d="M52.82,65.54v-4.14h1.8c.19,0,.36,.04,.51,.12,.15,.08,.29,.18,.4,.31,.11,.13,.2,.27,.27,.43,.06,.16,.1,.32,.1,.49,0,.18-.03,.36-.1,.52-.07,.17-.16,.31-.28,.43-.12,.12-.26,.21-.43,.26l.97,1.57h-.73l-.9-1.44h-.96v1.44h-.65Zm.65-2.02h1.14c.12,0,.23-.03,.32-.1,.09-.07,.17-.16,.22-.28,.06-.12,.08-.25,.08-.39s-.03-.27-.09-.39c-.06-.11-.14-.21-.24-.28-.1-.07-.21-.1-.32-.1h-1.11v1.54Z"/>
                                                        <path class="cls-2" d="M59.54,65.57c-.3,0-.57-.06-.81-.18-.24-.12-.45-.27-.62-.47-.17-.2-.31-.43-.4-.68-.1-.25-.14-.51-.14-.77s.05-.54,.15-.79c.1-.25,.24-.47,.42-.67,.18-.2,.39-.35,.63-.47,.24-.11,.51-.17,.79-.17s.56,.06,.81,.18c.24,.12,.45,.28,.62,.48,.17,.2,.31,.43,.4,.68,.1,.25,.14,.5,.14,.76,0,.27-.05,.54-.15,.79-.1,.25-.24,.47-.42,.67-.18,.2-.39,.35-.63,.46-.24,.11-.51,.17-.79,.17m-1.32-2.1c0,.19,.03,.38,.09,.57,.06,.18,.15,.35,.26,.49,.12,.14,.25,.25,.42,.34,.16,.08,.35,.12,.55,.12s.4-.04,.56-.13c.16-.09,.3-.2,.41-.35,.11-.15,.19-.31,.25-.49,.06-.18,.09-.36,.09-.55,0-.19-.03-.38-.09-.56-.06-.18-.15-.34-.26-.48-.12-.14-.26-.25-.42-.34-.16-.08-.34-.12-.54-.12-.21,0-.4,.04-.56,.13-.16,.09-.3,.2-.41,.34-.11,.14-.2,.31-.26,.48-.06,.18-.09,.36-.09,.55"/>
                                                        <path class="cls-2" d="M63.37,65.54v-4.14h1.74c.19,0,.36,.04,.51,.12,.16,.08,.29,.18,.41,.31,.12,.13,.21,.27,.27,.43,.06,.16,.09,.32,.09,.49,0,.23-.05,.45-.15,.65-.1,.21-.25,.38-.44,.51-.19,.13-.41,.19-.66,.19h-1.12v1.44h-.65Zm.65-2.02h1.08c.12,0,.23-.03,.33-.1,.09-.07,.17-.16,.22-.28,.05-.12,.08-.25,.08-.4s-.03-.29-.09-.4c-.06-.12-.14-.21-.24-.27-.1-.06-.21-.1-.32-.1h-1.04v1.54Z"/>
                                                        <polygon class="cls-2" points="71.01 64.96 71.01 65.54 68.17 65.54 68.17 61.4 70.95 61.4 70.95 61.98 68.82 61.98 68.82 63.16 70.67 63.16 70.67 63.7 68.82 63.7 68.82 64.96 71.01 64.96"/>
                                                        <path class="cls-2" d="M72.85,65.54v-4.14h1.8c.19,0,.36,.04,.51,.12,.15,.08,.29,.18,.4,.31,.11,.13,.2,.27,.27,.43,.06,.16,.1,.32,.1,.49,0,.18-.03,.36-.1,.52-.07,.17-.16,.31-.28,.43-.12,.12-.27,.21-.43,.26l.97,1.57h-.73l-.9-1.44h-.96v1.44h-.65Zm.65-2.02h1.14c.12,0,.23-.03,.32-.1,.09-.07,.17-.16,.22-.28,.06-.12,.08-.25,.08-.39s-.03-.27-.09-.39c-.06-.11-.14-.21-.24-.28-.1-.07-.21-.1-.32-.1h-1.11v1.54Z"/>
                                                        <polygon class="cls-2" points="80.86 61.98 79.49 61.98 79.49 65.54 78.83 65.54 78.83 61.98 77.45 61.98 77.45 61.4 80.86 61.4 80.86 61.98"/>
                                                        <rect class="cls-2" x="82.58" y="61.4" width=".65" height="4.14"/>
                                                        <polygon class="cls-2" points="88.17 64.96 88.17 65.54 85.33 65.54 85.33 61.4 88.12 61.4 88.12 61.98 85.98 61.98 85.98 63.16 87.83 63.16 87.83 63.7 85.98 63.7 85.98 64.96 88.17 64.96"/>
                                                        <path class="cls-2" d="M92.46,62.38s-.1-.09-.17-.14c-.07-.05-.16-.09-.26-.14-.1-.04-.21-.08-.33-.11-.12-.03-.24-.04-.36-.04-.27,0-.47,.05-.61,.15-.13,.1-.2,.24-.2,.42,0,.13,.04,.24,.11,.31,.07,.08,.19,.14,.34,.19,.15,.05,.34,.11,.57,.16,.28,.07,.52,.14,.73,.24,.21,.09,.36,.21,.47,.36,.11,.15,.16,.35,.16,.6,0,.21-.04,.39-.12,.54s-.19,.27-.33,.37c-.14,.09-.3,.16-.48,.21-.18,.04-.38,.07-.59,.07s-.41-.02-.62-.06c-.2-.04-.4-.11-.58-.19-.18-.08-.35-.18-.51-.31l.3-.56c.05,.05,.12,.11,.22,.17,.1,.06,.21,.12,.33,.17,.13,.05,.26,.1,.41,.14,.15,.04,.3,.06,.46,.06,.26,0,.46-.05,.6-.14,.14-.09,.21-.22,.21-.39,0-.14-.04-.25-.13-.33-.09-.08-.22-.15-.39-.21-.17-.06-.38-.12-.61-.17-.27-.07-.5-.15-.68-.24-.18-.09-.32-.2-.41-.34-.09-.14-.14-.31-.14-.53,0-.27,.07-.5,.2-.69,.13-.19,.31-.33,.54-.42,.23-.1,.48-.14,.77-.14,.19,0,.36,.02,.53,.06,.17,.04,.32,.1,.47,.17,.15,.07,.28,.15,.4,.24l-.3,.54Z"/>
                                                        <polygon class="cls-2" points="3.03 56.54 3.03 41.73 0 41.73 0 57.86 11.12 57.86 11.69 56.54 3.03 56.54"/>
                                                        <path class="cls-2" d="M17.18,41.73h-.99l-5.92,14.05h1.69l1.37-3.53h5.12l1.05,2.56s.34,.83,1.15,2.81l.1,.25h3.3l-6.89-16.13Zm-3.36,9.2l2.03-4.97,2.08,4.97h-4.11Z"/>
                                                        <polygon class="cls-2" points="36.68 52.56 28.54 41.73 25.62 41.73 25.62 57.86 26.92 57.86 26.92 44.54 37.12 57.86 38.13 57.86 38.13 41.73 36.68 41.73 36.68 52.56"/>
                                                        <path class="cls-2" d="M49.93,42.82c-1.3-.73-3.15-1.09-5.48-1.09h-4.64v16.13h4.6c1.28,0,2.28-.04,2.96-.13,.74-.07,1.5-.26,2.32-.6,.84-.34,1.58-.85,2.19-1.49,.62-.62,1.1-1.41,1.48-2.42,.36-.96,.54-2.03,.54-3.18,0-1.61-.32-3-.99-4.25-.65-1.26-1.63-2.22-2.98-2.96m-7.1,.28c.41-.02,.87-.04,1.33-.04,1.08,0,2.02,.11,2.79,.32,.7,.22,1.32,.61,1.88,1.2,.6,.62,1.05,1.39,1.34,2.29,.33,.99,.49,2.07,.49,3.32,0,1.56-.28,2.86-.83,3.88-.5,.96-1.15,1.61-1.94,1.94-.82,.35-1.87,.52-3.11,.52h-1.95v-13.44Z"/>
                                                        <polygon class="cls-2" points="66.55 52.56 58.41 41.73 55.49 41.73 55.49 57.48 56.79 57.48 56.79 44.54 66.98 57.86 67.99 57.86 67.99 41.73 66.55 41.73 66.55 52.56"/>
                                                        <polygon class="cls-2" points="69.65 57.86 79.39 57.86 79.39 56.52 72.66 56.52 72.66 50.07 77.1 50.07 77.1 48.73 72.66 48.73 72.66 43.05 79.43 43.05 79.43 41.73 69.65 41.73 69.65 57.86"/>
                                                        <path class="cls-2" d="M88.57,49.7c-.62-.47-1.57-1.07-2.74-1.74-1.31-.78-2.15-1.39-2.58-1.89-.41-.46-.58-.97-.52-1.54,.06-.5,.28-.92,.7-1.3,.38-.36,.96-.49,1.75-.4,.85,.08,1.55,.45,2.13,1.13,.15,.17,.29,.36,.41,.54l.26,.38,1.16-.95-.24-.32c-.6-.8-1.19-1.33-1.78-1.62-.63-.3-1.26-.48-1.93-.55-1.29-.12-2.4,.17-3.29,.86-.93,.71-1.47,1.68-1.59,2.88-.1,.75,.01,1.52,.32,2.29,.32,.74,.78,1.34,1.42,1.85,.61,.47,1.49,1.03,2.69,1.73,1.27,.71,2.13,1.32,2.56,1.83,.39,.48,.54,1.03,.47,1.7-.06,.64-.37,1.2-.94,1.67-.6,.5-1.37,.68-2.27,.55-1.47-.24-2.31-.85-3.45-2.47l-.3-.43-.99,1.09,.16,.27c.91,1.48,2.93,2.78,4.6,2.96,.27,.03,.53,.04,.79,.04,1.22,0,2.28-.32,3.15-.97,1.06-.81,1.67-1.93,1.82-3.34,.1-.9,0-1.71-.32-2.46-.32-.74-.79-1.33-1.43-1.79"/>
                                                        <polygon class="cls-2" points="90 41.73 89.94 43.04 95.78 43.04 95.78 57.86 98.81 57.86 98.81 43.04 104.7 43.04 104.7 41.73 90 41.73"/>
                                                        <path class="cls-1" d="M68.1,8.61c-.61-.13-1.23-.2-1.85-.2-.1,0-.19,0-.29,0-.02,0-.03,0-.05,0-.09,0-.19,0-.28,.02-.02,0-.04,0-.05,0-.09,0-.19,.02-.28,.03-.01,0-.02,0-.03,0-.09,.01-.18,.02-.27,.04-.01,0-.02,0-.03,0-.09,.01-.18,.03-.28,.05-.02,0-.04,0-.05,0-.09,.02-.18,.04-.27,.06-.01,0-.03,0-.04,.01-.09,.02-.19,.04-.28,.07,0,0,0,0,0,0-.09,.03-.19,.05-.28,.08-.01,0-.03,0-.05,.01-.09,.03-.18,.06-.26,.09-.02,0-.03,.01-.05,.02-.09,.03-.18,.06-.26,.1,0,0-.02,0-.03,0-.09,.03-.17,.07-.25,.11-.01,0-.02,0-.03,.01-.09,.04-.17,.08-.26,.12-.02,0-.03,.01-.05,.02-.08,.04-.17,.08-.25,.13-.01,0-.03,.01-.04,.02-.08,.04-.17,.09-.25,.14,0,0,0,0,0,0-.08,.05-.17,.1-.25,.15-.01,0-.03,.02-.04,.02-.08,.05-.16,.1-.23,.15,0,0-.01,0-.02,.01l-1.47-1.07s0-.02,.01-.04c0-.02,.01-.04,.02-.07,.02-.05,.04-.1,.05-.15,0-.02,.01-.04,.02-.07,.02-.06,.04-.12,.06-.19,0,0,0-.02,0-.02,.02-.07,.04-.14,.06-.21,0-.02,.01-.04,.02-.06,.01-.05,.03-.1,.04-.16,0-.02,.01-.05,.02-.07,.01-.06,.03-.11,.04-.17,0-.02,0-.03,0-.05,.01-.07,.03-.15,.04-.22,0-.02,0-.04,0-.05,0-.06,.02-.11,.03-.17,0-.02,0-.05,.01-.07,0-.05,.01-.11,.02-.16,0-.02,0-.04,0-.06,0-.07,.02-.15,.02-.22,0-.01,0-.03,0-.04,0-.06,0-.12,.01-.19,0-.02,0-.05,0-.07,0-.05,0-.11,0-.16,0-.02,0-.05,0-.07,0-.07,0-.15,0-.23,0-1.93-.63-3.76-1.82-5.28l-.44-.57-.7,.19c-.07,.02-.14,.04-.2,.06-.02,0-.04,.01-.05,.02-.05,.01-.1,.03-.15,.05-.02,0-.04,.01-.07,.02-.04,.01-.09,.03-.14,.05-.02,0-.04,.01-.07,.02-.05,.02-.1,.04-.14,.05-.02,0-.03,.01-.05,.02-.13,.05-.26,.1-.39,.16-.02,0-.04,.02-.05,.03-.05,.02-.09,.04-.14,.06-.02,0-.04,.02-.06,.03-.04,.02-.08,.04-.13,.06-.02,0-.04,.02-.06,.03-.04,.02-.09,.05-.14,.07-.02,0-.03,.02-.05,.03-.06,.03-.12,.07-.18,.1,0,0,0,0,0,0-.06,.03-.12,.07-.18,.1-.02,0-.03,.02-.05,.03-.04,.03-.08,.05-.13,.08-.02,.01-.04,.03-.06,.04-.04,.03-.08,.05-.12,.08-.02,.01-.04,.03-.06,.04-.04,.03-.09,.06-.13,.09-.01,0-.03,.02-.04,.03-.06,.04-.12,.08-.17,.12,0,0,0,0-.01,0-.05,.04-.1,.08-.15,.12-.02,.01-.03,.03-.05,.04-.04,.03-.08,.06-.12,.09-.02,.01-.04,.03-.05,.04-.04,.03-.07,.06-.11,.09-.02,.02-.04,.03-.05,.05-.04,.03-.08,.07-.12,.1-.01,.01-.03,.02-.04,.04-.05,.05-.1,.09-.15,.14,0,0-.01,0-.02,.01-.04,.04-.09,.09-.13,.13-.02,.02-.03,.03-.05,.05-.03,.03-.07,.07-.1,.1-.02,.02-.03,.04-.05,.05-.03,.03-.06,.07-.1,.1-.02,.02-.03,.03-.05,.05-.04,.04-.07,.08-.1,.12-.01,.01-.02,.03-.03,.04-.05,.05-.09,.11-.14,.16,0,0-.01,.02-.02,.02-.04,.04-.07,.09-.11,.14-.01,.02-.03,.04-.04,.05-.02,.02-.04,.05-.05,.07l-.75-.55-.75,.55s-.04-.05-.06-.07c-.01-.02-.03-.04-.04-.05-.04-.05-.07-.09-.11-.14,0,0-.01-.02-.02-.03-.04-.05-.09-.11-.13-.16-.01-.01-.02-.03-.04-.04-.03-.04-.07-.08-.1-.12-.02-.02-.03-.04-.05-.05-.03-.03-.06-.07-.1-.1-.02-.02-.03-.04-.05-.05-.03-.03-.07-.07-.1-.1-.02-.02-.03-.03-.05-.05-.04-.04-.08-.08-.13-.12,0,0-.02-.02-.02-.02-.05-.05-.1-.09-.15-.14-.01-.01-.03-.03-.04-.04-.04-.03-.07-.07-.11-.1-.02-.02-.04-.03-.06-.05-.03-.03-.07-.06-.1-.09-.02-.02-.04-.03-.06-.05-.04-.03-.07-.06-.11-.09-.02-.01-.04-.03-.05-.04-.05-.04-.1-.07-.14-.11,0,0-.01-.01-.02-.02-.06-.04-.11-.08-.17-.12-.02-.01-.03-.02-.05-.03-.04-.03-.08-.06-.12-.08-.02-.01-.04-.03-.06-.04-.04-.02-.07-.05-.11-.07-.02-.01-.04-.03-.06-.04-.04-.03-.08-.05-.12-.08-.02-.01-.04-.02-.06-.03-.05-.03-.11-.07-.16-.1,0,0-.01,0-.01,0-.06-.03-.12-.07-.18-.1-.02,0-.04-.02-.05-.03-.04-.02-.09-.05-.13-.07-.02-.01-.04-.02-.07-.03-.04-.02-.08-.04-.12-.06-.02,0-.04-.02-.07-.03-.04-.02-.09-.04-.13-.06-.02,0-.04-.02-.06-.03-.13-.06-.26-.11-.39-.16-.02,0-.04-.01-.05-.02-.05-.02-.1-.04-.14-.05-.02,0-.04-.01-.07-.02-.05-.02-.09-.03-.14-.05-.02,0-.04-.01-.07-.02-.05-.02-.1-.03-.15-.05-.02,0-.04-.01-.05-.02-.07-.02-.13-.04-.2-.06l-.7-.19-.44,.57c-1.19,1.52-1.82,3.35-1.82,5.28,0,.08,0,.15,0,.23,0,.02,0,.05,0,.07,0,.05,0,.11,0,.16,0,.02,0,.05,0,.07,0,.06,0,.12,.01,.19,0,.01,0,.03,0,.04,0,.07,.01,.15,.02,.22,0,.02,0,.04,0,.06,0,.06,.01,.11,.02,.16,0,.02,0,.05,.01,.07,0,.06,.02,.11,.03,.17,0,.02,0,.04,0,.06,.01,.07,.03,.15,.04,.22,0,.02,.01,.04,.02,.06,.02,.07,.04,.14,.06,.21,0,0,0,.02,0,.03,.02,.06,.04,.13,.06,.19,0,.02,.01,.04,.02,.07,.02,.05,.04,.1,.05,.15,0,.02,.01,.04,.02,.07,0,.01,0,.02,.01,.04l-1.44,1.05s-.01,0-.02-.01c-.08-.05-.15-.1-.23-.15-.01,0-.03-.02-.04-.03-.08-.05-.16-.1-.24-.15,0,0,0,0-.01,0-.08-.05-.16-.09-.25-.14-.01,0-.02-.01-.04-.02-.08-.04-.17-.08-.25-.12-.02,0-.03-.02-.05-.02-.08-.04-.17-.08-.25-.12-.01,0-.02,0-.03-.01-.09-.04-.17-.07-.26-.11,0,0-.01,0-.02,0-.09-.03-.18-.07-.26-.1-.02,0-.03-.01-.05-.02-.09-.03-.18-.06-.26-.09-.01,0-.03,0-.04-.01-.09-.03-.18-.05-.28-.08,0,0,0,0,0,0-.09-.02-.19-.05-.28-.07-.01,0-.03,0-.04,0-.09-.02-.18-.04-.27-.06-.02,0-.03,0-.05,0-.09-.02-.18-.03-.28-.05-.01,0-.02,0-.03,0-.09-.01-.18-.02-.27-.04,0,0-.02,0-.03,0-.09-.01-.19-.02-.28-.03-.02,0-.04,0-.05,0-.09,0-.19-.01-.28-.02-.02,0-.03,0-.05,0-.1,0-.19,0-.29,0-.65,0-1.29,.07-1.92,.22l-.93,.21,.09,.95c0,.09,.02,.19,.03,.28v.05c.02,.09,.03,.18,.04,.27,0,.02,0,.04,0,.05,.01,.09,.03,.18,.05,.28,0,0,0,0,0,0,.02,.09,.04,.18,.06,.27,0,.02,0,.03,.01,.05,.02,.09,.04,.18,.07,.26,0,.02,0,.04,.01,.05,.03,.09,.05,.18,.08,.27v.02c.03,.09,.06,.17,.09,.26,0,.01,0,.03,.01,.04,.03,.09,.06,.17,.09,.26,0,.02,.01,.03,.02,.05,.03,.09,.07,.17,.11,.26,0,0,0,.01,0,.02,.03,.08,.07,.17,.11,.25,0,.01,.01,.02,.02,.04,.04,.08,.08,.16,.12,.25,0,.01,.02,.03,.02,.05,.04,.08,.09,.16,.13,.25,0,0,0,.02,.01,.02,.04,.08,.09,.16,.13,.24,0,0,.01,.02,.02,.03,.05,.08,.1,.16,.15,.24,0,.01,.02,.03,.03,.04,.05,.08,.1,.16,.15,.23,0,0,.01,.02,.02,.02,.05,.07,.1,.15,.16,.22,0,0,0,.01,.01,.02v20.15h8.88c.07-.77,.28-1.51,.6-2.18,.57-1.2,1.51-2.19,2.7-2.84,.03-.02,.06-.03,.09-.05,.04-.02,.08-.04,.13-.07,.01,0,.02-.01,.04-.02,.07-.04,.15-.07,.22-.1,.03-.01,.06-.03,.1-.04,.1-.04,.2-.08,.3-.12,.06-.02,.12-.04,.18-.06,.05-.01,.09-.03,.14-.04,.07-.02,.13-.04,.2-.06l.12-.03c.07-.02,.14-.03,.2-.05,.04,0,.09-.02,.13-.03,.07-.01,.13-.03,.2-.04,.05,0,.1-.02,.15-.02,.06,0,.12-.02,.18-.02,.07,0,.13-.01,.2-.02,.05,0,.1,0,.15-.01,.12,0,.23,0,.35,0h0c.12,0,.23,0,.35,0,.05,0,.1,0,.15,.01,.06,0,.13,0,.19,.02,.07,0,.13,.02,.19,.02,.05,0,.09,.01,.14,.02,.07,.01,.14,.02,.21,.04,.04,0,.07,.01,.11,.02,.08,.02,.15,.03,.23,.05,.02,0,.05,.01,.07,.02,.24,.07,.48,.15,.72,.24,.05,.02,.1,.04,.16,.06,.05,.02,.1,.04,.15,.07,.06,.03,.12,.06,.18,.09,.02,.01,.05,.02,.07,.04,.03,.01,.05,.03,.08,.04,.03,.01,.05,.03,.08,.04,.06,.04,.13,.07,.19,.11,.02,.01,.04,.02,.06,.04,.88,.54,1.61,1.27,2.13,2.14,0,0,0,0,0,0,.05,.08,.1,.17,.15,.26,0,0,0,0,0,0,.05,.09,.1,.18,.14,.27,.32,.67,.53,1.4,.6,2.18h8.88V14.4s.01-.01,.01-.02c.05-.07,.1-.14,.15-.21,0-.01,.01-.02,.02-.03,.05-.07,.1-.15,.15-.23,.01-.02,.02-.03,.03-.05,.05-.08,.1-.15,.15-.23,0-.01,.01-.02,.02-.03,.04-.08,.09-.15,.13-.23,0-.01,.01-.02,.02-.03,.04-.08,.09-.16,.13-.24,0-.02,.02-.03,.02-.05,.04-.08,.08-.16,.12-.25,0-.01,.01-.03,.02-.04,.04-.08,.07-.16,.11-.24,0,0,0-.02,0-.02,.04-.09,.07-.17,.11-.26,0-.02,.01-.03,.02-.05,.03-.09,.06-.17,.09-.26,0-.01,0-.03,.01-.04,.03-.09,.06-.17,.08-.26,0,0,0-.01,0-.02,.03-.09,.05-.18,.08-.27,0-.02,0-.03,.01-.05,.02-.09,.05-.18,.07-.27,0,0,0,0,0,0,.02-.09,.03-.19,.05-.28,0-.02,0-.04,0-.05,.01-.09,.03-.18,.04-.27,0-.02,0-.03,0-.05,.01-.09,.02-.19,.03-.28l.09-.95-.93-.21Zm-6.57,4.05l2.51,1.83c-1.17,.88-2.58,1.36-4.08,1.36,.21-1.19,.76-2.3,1.58-3.2m-2.59-1.9l.83,.6c-1.02,1.18-1.7,2.62-1.97,4.16-1.05-.34-2-.92-2.77-1.69,1.57-.61,2.94-1.68,3.91-3.07m-1.55-8.24c.61,1,.93,2.13,.93,3.32,0,.13,0,.25-.01,.37,0,.13-.02,.26-.03,.39-.03,.29-.09,.57-.16,.85l-3.69-2.7c.76-1,1.79-1.78,2.96-2.24m-4,4.17l3.8,2.78c-.84,1.21-2.07,2.1-3.48,2.51-.46-.94-.7-1.98-.7-3.04,0-.77,.13-1.53,.38-2.26m-2.93,0c.25,.72,.38,1.49,.38,2.26,0,1.06-.24,2.1-.7,3.04-1.41-.41-2.64-1.3-3.48-2.51l3.8-2.78Zm-4-4.17c1.17,.46,2.2,1.24,2.96,2.24l-3.69,2.7c-.14-.52-.2-1.06-.2-1.61,0-1.19,.32-2.33,.93-3.32m-1.55,8.24c.97,1.39,2.34,2.46,3.91,3.07-.76,.76-1.69,1.34-2.72,1.68-.27-1.54-.95-2.99-1.99-4.17l.79-.58Zm-2.55,1.87c.83,.9,1.39,2.02,1.6,3.22h-.02c-1.52,0-2.94-.48-4.13-1.36l2.54-1.86Zm1.61,5.4c-.44,2.63-2.5,4.73-5.11,5.23v-6.79c1.49,1.01,3.26,1.56,5.09,1.56,0,0,.02,0,.03,0m-6.74-7.44c.14,0,.29-.01,.43-.01,.19,0,.37,0,.56,.02,.81,.07,1.6,.3,2.32,.66l-2.25,1.65c-.5-.7-.85-1.49-1.06-2.32m6.59,21.78h-4.97v-6.91c1.86-.26,3.57-1.11,4.91-2.47,.07-.08,.15-.15,.22-.23v5.8h2.46c-1.2,1-2.11,2.32-2.62,3.81m2.34-5.99v-7.48l5.78-4.23,5.78,4.23v7.48h-11.55Zm18.86,5.99h-4.97c-.51-1.49-1.42-2.81-2.62-3.81h2.46v-5.86c.08,.09,.17,.18,.26,.27,1.32,1.35,3.03,2.21,4.87,2.48v6.92Zm0-9.13c-2.58-.52-4.62-2.62-5.06-5.22,1.81,0,3.57-.56,5.06-1.56v6.78Zm.57-10.33l-2.23-1.63c.9-.46,1.9-.7,2.92-.7,.12,0,.25,0,.37,0-.2,.84-.56,1.62-1.06,2.33"/>
                                                    </g>
                                                </svg>
                                                <p style="margin: 5px 0 0 0; font-style: italic; font-size: 12px; color: #333333; font-family: Arial, sans-serif;">...quality investments, elite living</p>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </td>
            </tr>
        </tbody>
    </table>
</div>`;
        }
        
        // URL safety helper and Zoho-safe generator
        function safeUrl(value, fallback) {
            try {
                if (!value) return fallback;
                if (typeof value === 'string' && value.startsWith('data:image/')) return value;
                const u = new URL(value);
                return (u.protocol === 'http:' || u.protocol === 'https:') ? value : fallback;
            } catch (e) {
                return fallback;
            }
        }
        
        function generateSignatureZoho() {
            const name = document.getElementById('name').value || '{{ Name }}';
            const email = document.getElementById('email').value || '{{ Email Address }}';
            const role = document.getElementById('role').value || '{{ Job Title }}';
            const profileInput = document.getElementById('profileImage').value;
            const logoInput = (document.getElementById('logoImage') && document.getElementById('logoImage').value) || '';
            const profileSrc = safeUrl(profileInput, 'https://via.placeholder.com/110.png?text=Photo');
            const logoSrc = safeUrl(logoInput, 'https://via.placeholder.com/150x50.png?text=LANDNEST');
            return `<table width="600" cellpadding="0" cellspacing="0" border="0" style="font-family: Arial, sans-serif;">
    <tr>
        <td width="140" valign="top" rowspan="2" align="left" style="padding-left: 30px;">
            <img src="${profileSrc}" width="110" height="110" alt="Profile" style="display: block; border-radius: 55px; border: 6px solid #ffffff;">
        </td>
        <td colspan="2" style="background: #f5b062; height: 100px; line-height: 0; font-size: 0;">&nbsp;</td>
    </tr>
    <tr>
        <td valign="top" style="background: #ffffff; padding: 0 30px 20px 0;">
            <div style="height: 20px; line-height: 20px; font-size: 0;">&nbsp;</div>
            <p style="margin: 0; font-size: 18px; font-weight: bold; color: #000000;">${name}</p>
            <p style="margin: 10px 0 0 0; font-size: 14px; color: #008080;">${email}</p>
            <span style="display: inline-block; margin-top: 8px; background: #008080; color: #ffffff; padding: 10px; font-size: 14px; font-weight: bold;">${role}</span>
        </td>
        <td width="200" valign="middle" align="center" style="background: #ffffff;">
            <table cellpadding="0" cellspacing="0" border="0">
                <tr>
                    <td width="20">&nbsp;</td>
                    <td width="1" style="border-left: 1px solid #008080;">&nbsp;</td>
                    <td width="20">&nbsp;</td>
                    <td width="150" align="center">
                        <img src="${logoSrc}" width="150" alt="LANDNEST" style="display: block;">
                        <p style="margin: 5px 0 0 0; font-style: italic; font-size: 12px; color: #333333;">...quality investments, elite living</p>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>`;
        }
        
        // Update preview
        function updatePreview() {
            const preview = document.getElementById('preview');
            preview.innerHTML = generateSignatureZoho();
        }
        
        // Copy signature to clipboard
        async function copySignature() {
            const signatureHTML = generateSignatureZoho();
            
            try {
                await navigator.clipboard.writeText(signatureHTML);
                showSuccessMessage();
            } catch (err) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = signatureHTML;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showSuccessMessage();
            }
        }
        
        // Download signature as HTML file
        function downloadSignature() {
            const signatureHTML = `<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Signature</title>
    <style type="text/css">
        body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
        table { border-spacing: 0; }
        td { padding: 0; }
        img { border: 0; }
    </style>
</head>
<body>
    ${generateSignatureZoho()}
</body>
</html>`;

            const blob = new Blob([signatureHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'email-signature.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Download signature as PNG with max 600px width
        async function downloadSignaturePNG() {
            const preview = document.getElementById('preview');
            const name = document.getElementById('name').value || 'signature';

            try {
                // Use html2canvas to render the signature as an image
                const canvas = await html2canvas(preview, {
                    backgroundColor: '#ffffff',
                    scale: 2,  // Higher resolution for crisp output
                    useCORS: true,
                    allowTaint: true,
                    width: 600  // Render at 600px width
                });

                // Create a new canvas for final output
                const outputCanvas = document.createElement('canvas');
                const ctx = outputCanvas.getContext('2d');

                // Calculate dimensions to maintain aspect ratio within 600px max width
                const maxWidth = 600;
                const sourceWidth = canvas.width;
                const sourceHeight = canvas.height;
                let targetWidth = maxWidth;
                let targetHeight = Math.round((sourceHeight * maxWidth) / sourceWidth);

                // If original is already 600px or less, use original size
                if (sourceWidth <= maxWidth) {
                    targetWidth = sourceWidth;
                    targetHeight = sourceHeight;
                }

                // Set canvas dimensions
                outputCanvas.width = targetWidth;
                outputCanvas.height = targetHeight;

                // Draw and scale the image
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                ctx.drawImage(canvas, 0, 0, targetWidth, targetHeight);

                // Create download link
                const link = document.createElement('a');
                link.download = `${name.replace(/\s+/g, '-')}-signature.png`;
                link.href = outputCanvas.toDataURL('image/png');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                alert('PNG signature downloaded successfully! Image dimension: ' + targetWidth + 'x' + targetHeight + 'px');
            } catch (error) {
                console.error('PNG generation failed:', error);
                alert('Failed to generate PNG: ' + error.message);
            }
        }
        
        // Show success message
        function showSuccessMessage() {
            const message = document.getElementById('successMessage');
            message.style.display = 'block';
            setTimeout(() => {
                message.style.display = 'none';
            }, 3000);
        }

        // Show crop modal
        function showCropModal() {
            const modal = document.getElementById('cropModal');
            const image = document.getElementById('cropImage');
            const profileImageInput = document.getElementById('profileImage');

            if (!window.originalImageData) {
                alert('No image to crop. Please upload an image first.');
                return;
            }

            image.src = window.originalImageData;
            modal.classList.add('show');

            // Initialize cropper when image loads
            if (window.cropperInstance) {
                window.cropperInstance.destroy();
            }

            image.onload = function() {
                window.cropperInstance = new Cropper(image, {
                    aspectRatio: 1, // Square aspect ratio for profile pictures
                    viewMode: 1,
                    scalable: true,
                    zoomable: true,
                    cropBoxMovable: true,
                    cropBoxResizable: true,
                });
            };
        }

        // Commit crop
        function commitCrop() {
            const canvas = window.cropperInstance.getCroppedCanvas({
                width: 300,
                height: 300,
                minWidth: 256,
                minHeight: 256,
                maxWidth: 4096,
                maxHeight: 4096,
            });

            if (canvas) {
                // Get the cropped image as data URL
                const croppedImageData = canvas.toDataURL('image/png');
                document.getElementById('profileImage').value = croppedImageData;
                updatePreview();

                // Hide modal
                document.getElementById('cropModal').classList.remove('show');

                // Clean up cropper
                if (window.cropperInstance) {
                    window.cropperInstance.destroy();
                    window.cropperInstance = null;
                }
            } else {
                alert('Failed to crop image. Please try again.');
            }
        }

        // Cancel crop
        function cancelCrop() {
            const modal = document.getElementById('cropModal');
            modal.classList.remove('show');

            // Clean up cropper
            if (window.cropperInstance) {
                window.cropperInstance.destroy();
                window.cropperInstance = null;
            }
        }

        // Save cropped image as PNG
        function saveCroppedImage() {
            if (!window.cropperInstance) {
                alert('Cropper not found. Please wait for the image to load and crop it.');
                return;
            }

            try {
                const canvas = window.cropperInstance.getCroppedCanvas({
                    width: 300,
                    height: 300,
                    minWidth: 256,
                    minHeight: 256,
                    maxWidth: 4096,
                    maxHeight: 4096,
                });

                if (!canvas) {
                    alert('Failed to get cropped canvas. Make sure you have selected an area to crop.');
                    return;
                }

                canvas.toBlob(function(blob) {
                    if (!blob) {
                        alert('Failed to generate image file. Try again.');
                        return;
                    }

                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'cropped-profile-image.png';
                    a.style.display = 'none';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    alert('Cropped image saved successfully!');
                }, 'image/png');
            } catch (error) {
                alert('Error saving cropped image: ' + error.message);
            }
        }

        // Add event listeners for real-time updates
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = ['name', 'email', 'role', 'profileImage'];
            if (document.getElementById('logoImage')) inputs.push('logoImage');
            inputs.forEach(id => {
                document.getElementById(id).addEventListener('input', updatePreview);
            });
            
            // Initial preview update
            updatePreview();
        });
    </script>
</body>
</html>
